#!/usr/bin/env bash
set -euo pipefail
source "$(dirname "${BASH_SOURCE[0]}")/../include/common.bash"

if [[ $# < 1 ]]; then
    echo "Usage: na4ma4-install-lib name"
    echo
    echo "  Installs a na4ma4 Makefiles extension library."
    echo
    exit 1
fi

name="$1"

target="$NA4MA4_MF_ROOT/lib/$name"

if [ ! -d "$target" ]; then
    log "[na4ma4] copying $name library from main cache"
    mkdir -p "$target"
    cp -r ".makefiles/ext/na4ma4/lib/cache/$name" "$target"
fi

if [ -d "$target/install.d" ]; then
    log "[na4ma4] executing $name library installation hooks"
    for file in "$target/install.d/"*; do
        "$file"
    done
fi
